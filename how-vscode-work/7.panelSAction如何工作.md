#### 一、panelAction 如何工作

1、workbench.action.togglePanel 指令可以触发 panel 显隐
2、这个指令在 src/vs/workbench/browser/parts/panel/panelActions.ts 注册

```ts
export class TogglePanelAction extends Action2 {
	static readonly ID = "workbench.action.togglePanel";
	static readonly LABEL = localize2(
		"togglePanelVisibility",
		"Toggle Panel Visibility"
	);

	constructor() {
		super({
			id: TogglePanelAction.ID,
			title: TogglePanelAction.LABEL,
			toggled: {
				condition: PanelVisibleContext,
				title: localize("closePanel", "Hide Panel"),
				icon: closeIcon,
				mnemonicTitle: localize(
					{ key: "toggle panel mnemonic", comment: ["&& denotes a mnemonic"] },
					"&&Panel"
				),
			},
			icon: closeIcon, // Ensures no flickering when using toggled.icon
			f1: true,
			category: Categories.View,
			metadata: {
				description: localize(
					"openAndClosePanel",
					"Open/Show and Close/Hide Panel"
				),
			},
			keybinding: {
				primary: KeyMod.CtrlCmd | KeyCode.KeyJ,
				weight: KeybindingWeight.WorkbenchContrib,
			},
			menu: [
				{
					id: MenuId.MenubarAppearanceMenu,
					group: "2_workbench_layout",
					order: 5,
				},
				{
					id: MenuId.LayoutControlMenuSubmenu,
					group: "0_workbench_layout",
					order: 4,
				},
				{
					id: MenuId.PanelTitle,
					group: "navigation",
					order: 2,
				},
			],
		});
	}

	override async run(accessor: ServicesAccessor): Promise<void> {
		console.log("workbench.action.togglePanel");
		const layoutService = accessor.get(IWorkbenchLayoutService);
		layoutService.setPartHidden(
			layoutService.isVisible(Parts.PANEL_PART),
			Parts.PANEL_PART
		);
	}
}

// 通过这个注册
registerAction2(TogglePanelAction);
```

3、模仿编写一个 simulator 的 ation
新建 src/vs/workbench/browser/parts/simulator/simulatorActions.ts

```ts
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

import { localize2 } from "../../../../nls.js";
import {
	Action2,
	registerAction2,
} from "../../../../platform/actions/common/actions.js";
import { ServicesAccessor } from "../../../../platform/instantiation/common/instantiation.js";
// import { IWorkbenchLayoutService, Parts } from '../../../services/layout/browser/layoutService.js';

export class ToggleSimulatorAction extends Action2 {
	static readonly ID = "workbench.action.toggleSimulator";
	static readonly LABEL = localize2(
		"toggleSimulatorVisibility",
		"Toggle Simulator Visibility"
	);

	constructor() {
		super({
			id: ToggleSimulatorAction.ID,
			title: ToggleSimulatorAction.LABEL,
		});
	}

	override run(accessor: ServicesAccessor, ...args: any[]): void {
		console.log("toggleSimulator");
		const layoutService = accessor.get(IWorkbenchLayoutService);
		layoutService.setPartHidden(
			layoutService.isVisible(Parts.SIMULATOR_PART),
			Parts.SIMULATOR_PART
		);
	}
}

registerAction2(ToggleSimulatorAction);
```

run 里面会走到 setPartHidden。
在 layout.ts

```ts
setPartHidden(hidden: boolean, part: Parts): void {
console.log('setPartHidden: ', part, hidden);
switch (part) {
	case Parts.SIMULATOR_PART:
		return this.setSimulatorHidden(hidden);
	case Parts.ACTIVITYBAR_PART:
		return this.setActivityBarHidden(hidden);
	case Parts.SIDEBAR_PART:
		return this.setSideBarHidden(hidden);
	case Parts.EDITOR_PART:
		return this.setEditorHidden(hidden);
	case Parts.BANNER_PART:
		return this.setBannerHidden(hidden);
	case Parts.AUXILIARYBAR_PART:
		return this.setAuxiliaryBarHidden(hidden);
	case Parts.PANEL_PART:
		return this.setPanelHidden(hidden);
}
}
```

实现 setSimulatorHidden

```ts
private setSimulatorHidden(hidden: boolean): void {
	this.stateModel.setRuntimeValue(LayoutStateKeys.SIMULATOR_HIDDEN, hidden);

	// Adjust CSS
	if (hidden) {
		this.mainContainer.classList.add(LayoutClasses.AUXILIARYBAR_HIDDEN);
	} else {
		this.mainContainer.classList.remove(LayoutClasses.AUXILIARYBAR_HIDDEN);
	}
	this.workbenchGrid.setViewVisible(this.simulatorPartView, !hidden);
}
```

isVisible 实现。 也是在 layout.ts

```ts
switch (part) {
	case Parts.SIMULATOR_PART:
		return !this.stateModel.getRuntimeValue(LayoutStateKeys.SIMULATOR_HIDDEN);
}
```

注册 LayoutStateKeys.SIMULATOR_HIDDEN。 也是在 layout.ts

```ts
SIMULATOR_HIDDEN: new RuntimeStateKey<boolean>('simulator.hidden', StorageScope.WORKSPACE, StorageTarget.MACHINE, true),
```
